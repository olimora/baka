{
    "collab_server" : "",
    "contents" : "<style>\n.notimportant {\n  color: \t#909090\n}\n\n</style>\n\nPREDIKCIA VÝROBY ELEKTRINY Z OBNOVITEĽNÝCH ZDROJOV SO ZOHĽADNENÍM EXTERNÝCH FAKTOROV\n========================================================\nauthor: Oliver Moravčík\ndate: 14.4.2016\nautosize: true\nfont-family: 'Helvetica'\n\nPrehľad\n========================================================\n- Cieľ\n  - predpovedať produkciu fotovoltaických elektrární na deň dopredu\n- Dáta \n  - meteorologické predpovede od SHMÚ, model Aladin \n  - záznamy z produkcie FVE (fotovoltaických elektrární)\n  - slnečné koordináty / solárne dáta\n  - PostgreSQL\n- Predikčný model\n  - R\n  - random forest\n\nDáta\n========================================================\n- Aladin\n  - model numerickej predpovede počasia\n  - 24 hodín dopredu \n  - čas v UTC, hodinové kroky\n  - bodové záznamy => konkrétny bod na časovej osi\n  - teplota\n  - rýchlosť vetra\n  - celková oblačnosť (%)\n  - relatívna vlhkosť (%)\n  - globálne ožiarenie\n\n========================================================\n<br>      \n- FVE\n  - čas v CEST, 15-minutové kroky\n  - <div class=\"notimportant\">výkon [kW]</div>\n  - energia (práca) [kWh]\n  - intervalové záznamy => záznam z 12:00 = 11:45 - 12:00\n  - niekoľko chybových záznamov/dní\n\n========================================================\n- Slnečné koordináty / solárne dáta:\n  - azimut (od východu na západ)\n  - elevácia (výška Slnka na oblohe)\n  - dĺžka dňa (počet hodín, kedy je Slnko nad horizontom)\n\n```{r eval=FALSE}\nlibrary(insol)\nlibrary(RPostgreSQL)\nall_hours <- seq(ISOdate(2014,7,1,00), \n                 ISOdate(2015,11,1,00),by='hour')\nsun_pos <- sunpos(sunvector(JD(all_hours), \n                            lat, long, tmz))\nsun_pos <- cbind(sun_pos, \n                 elev = 90 - sun_pos[,'zenith'])\nsun_pos <- data.frame(sun_pos, \n                  time = as.character(all_hours))\n```\n\nMetriky presnosti\n========================================================\n- hodnoty nameranej vyprodukovanej energie sú sčítané za celý deň\n- predpovedaná hodnota - $y_{i,p}$, skutočná hodnota - $y_{i,s}$ \n- odmocnina zo strednej kvadratickej chyby\n$$RMSE=\\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}(y_{i,p} - y_{i,s})^n}$$\n- priemerná absolútna chyba\n$$MAE=\\frac{1}{N}\\sum_{i=1}^{N}|y_{i,p} - y_{i,s}|$$\n\n========================================================\n- normalizované (%)\n$$RRMSE=RMSE*\\frac{100}{\\frac{1}{N}\\sum_{i=1}^{N}y_{i,s}}$$\n<br><br>\n```{r, eval=FALSE}\nlibrary(sirad)\nstatistics <- modeval(predicted, actual, stat=c(\"RMSE\",\"RRMSE\",\"MAE\",\"RMAE\"))\n```\n\nRandom forest\n========================================================\n- náhodný les regresných stromov\n- každý strom z náhodnej podmnožiny prediktorov\n- každý uzol je vytvorený ako najlepšie možné rozdelenie, podľa prediktorov náhodne vybraných pri danom uzle\n- výber prediktorov do podmnožín má normálne rozdelenie\n- výstup je priemer hlasov (regresia) \n\n```{r, eval=FALSE}\nlibrary(randomForest)\nforest <- randomForest(data=train_set,\n  formula=praca~gho+oblacnost+teplota+dlzkadna)\noutput <- predict(forest, test_set, type=\"response\", norm.votes=TRUE)\n\n```\n\nNastavenia modelu\n========================================================\n- po dňoch: \n  - počet stromov: 700\n  - počet uzlov stromu: 2 z 5\n  - veľkosť trénovacej množiny: 110\n\n- po hodinách:\n  - počet stromov: 500\n  - počet uzlov stromu: 2 z 7\n  - veľkosť trénovacej množiny: 30\n- počet uzlov stromu = odmicnina z počtu prediktorov\n  \nVýber trénovacej množiny\n========================================================\n- najpodobnejšie dni/hodiny\n- faktory podobnosti:\n  - globálne žiarenie: 90\n  - teplota: 10\n  - vietor: 1\n  \n```{r, eval=FALSE}\ndiff <- sapply(1:length(diff), function(x) {\n  ret <- abs(hour[['gho']] - potencial[[x,'gho']]) * 100 / scale[['gho']] * 90\n  return(ret)\n})\n```\n\n\nVýsledky\n========================================================\nleft: 50%\n```{r, echo=FALSE}\nvys  <- read.table(header = T, text='nastavenia metrika chyba\n 1 \"30 predch. dní\" rRMSE 29.39\n 2 \"30 predch. dní\" rMAE  23.26\n 3 \"30 najpodob. dní\" rRMSE 24.88\n 4 \"30 najpodob. dní\" rMAE  18.84')\nvys$metrika <- factor(vys$metrika, levels = c(\"rRMSE\", \"rMAE\"))\nvys$nastavenia <- factor(vys$nastavenia, levels = c(\"30 predch. dní\", \"30 najpodob. dní\"))\nlibrary(ggplot2)\nggplot(vys, aes(nastavenia, chyba, fill = metrika)) + \n  geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n  scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Trénovacia množina\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 32))\n```\n***\n- červená = RRMSE\n- modrá = RMAE\n\n- predch. 30 dní\n- žiarenie * 90   \n`+` teplota * 10   \n`+` vietor * 1\n\nLeto vs. zima\n========================================================\nleft: 50%\n- leto = 21. marec až 23. september = 636 dní\n- zima = 24. september až 20. marec = 513 dní\n- 2.4 x menšia chyba v lete\n\n***\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie metrika chyba\n 1 zima rrmse 45.7\n 2 zima rmae  34.6\n 3 leto rrmse 19.5\n 4 leto rmae  14.2')\ndf$obdobie <- factor(df$obdobie, levels = c(\"zima\", \"leto\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rrmse\", \"rmae\"))\nlibrary(ggplot2)\nggplot(df, aes(obdobie, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), size = 15)\n```\n\n========================================================\n- malé hodnoty žiarenia\n- nulové alebo minimálne hodnoty vyprodukovanej energie - zanedbateľné\n- slnečný svit => žiarenie > 120 W/m2\n- prvá a posledná hodina dňa = východ/západ slnka\n\n\ndáta   | počet hodín | % hodín | % sum(energia)\n-------|-------------|---------|---------------\nvšetky |      14 117 |  100.00 |    100.00\n> 120  |       9 421 |   66.74 |     93.34\np. a p.|       7 265 |   51.46 |     83.65\n\n========================================================\npredikcia po dňoch:\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='data metrika chyba\n 1 all rrmse 25.32\n 2 all rmae  19.92\n 3 svit rrmse 23.91\n 4 svit rmae  19.08\n 5 pp  rrmse 23.47\n 6 pp  rmae  17.44')\ndf$data <- factor(df$data, levels = c(\"all\", \"svit\", \"pp\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rrmse\", \"rmae\"))\nlibrary(ggplot2)\nggplot(df, aes(data, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), size = 15)\n```\n\n***\npo hodinách:\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='data metrika chyba\n 1 all rrmse 25.12\n 2 all rmae  19.36\n 3 svit rrmse 23.62\n 4 svit rmae  18.15\n 5 pp  rrmse 22.66\n 6 pp  rmae  17.14')\ndf$data <- factor(df$data, levels = c(\"all\", \"svit\", \"pp\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rrmse\", \"rmae\"))\nlibrary(ggplot2)\nggplot(df, aes(data, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), size = 15)\n```\n\nNajpresnejšia predikcia\n========================================================\nleft:\n- po hodinách\n- faktory podobnosti:\n  - žiarenie: 190    \n  - oblačnosť: 100      \n  - teplota: 30      \n  - vietor: 5.5\n  - vlhkosť: 1.5\n  - dĺžka dňa: 53\n  - elevácia: 1270\n\n***\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='data metrika chyba\n 1 all rrmse 24.55\n 2 all rmae  18.66\n 3 svit rrmse 23.17\n 4 svit rmae  17.53\n 5 pp  rrmse 22.36\n 6 pp  rmae  16.79')\ndf$data <- factor(df$data, levels = c(\"all\", \"svit\", \"pp\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rrmse\", \"rmae\"))\nlibrary(ggplot2)\nggplot(df, aes(data, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), size = 15)\n```\n\n========================================================\nleft: 50%\nVýroba - priemer na deň\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie vyrobene\n 1 zima 683.3\n 2 leto 1646.8')\ndf$obdobie <- factor(df$obdobie, levels = c(\"zima\", \"leto\"))\nlibrary(ggplot2)\nggplot(data=df, aes(x=obdobie, y=vyrobene)) +\n  geom_bar(stat=\"identity\") + \n geom_text(aes(label = vyrobene, y = vyrobene), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n scale_fill_brewer(palette = \"Set1\") + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Obdobie\") +\n  ylab(\"Priem. denná produkcia [kWh]\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 1800))\n```\n\n***\nChyba predikcie\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie metrika chyba\n 1 zima rrmse 36.1\n 2 zima rmae  26.94\n 3 leto rrmse 18.95\n 4 leto rmae  14.4')\ndf$obdobie <- factor(df$obdobie, levels = c(\"zima\", \"leto\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rrmse\", \"rmae\"))\nlibrary(ggplot2)\nggplot(df, aes(obdobie, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), size = 15)\n```\n\n\n\nZrýchlenie výpočtov v R\n========================================================\n- alokácia pamäti\n- vektorizácia (namiesto cyklov)\n- matica namiesto tabuľky\n- paralelizmus\n\n\n```{r, eval=FALSE}\nlibrary(snow)\ncl <- makeCluster(4, type='SOCK')\nclusterEvalQ(cl, myFun <- function(x) UseMethod(\"myFun\"))\nclusterEvalQ(cl, { library(plyr); library(randomForest) })\nclusterExport(cl, list(\"var1\", \"var2\"))\noutput <- parSapply(cl, vec, function(x) {return(vec + var1 + var2)})\nstopCluster(cl)\n```\n\n========================================================\n\n```{r, echo=FALSE}\ncasy  <- read.table(header = T, text='sposob sekundy\n 1 \"bez zmien\" 87\n 2 \"matica, alokácia,\\nvektorové funkcie, \" 35\n 3 \"paralelizácia\" 16')\nlibrary(ggplot2)\nggplot(casy, aes(sposob, sekundy, fill = sposob)) + \n  geom_bar(stat=\"identity\", position = \"dodge\", show.legend = F) + \n  geom_text(aes(label = sekundy, y = sekundy), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  scale_fill_brewer(palette = \"Set1\") + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Zmeny v zdrojovom kóde\") +\n  ylab(\"Počet sekúnd\") + \n # ggtitle(\"Porovnanie časov \\n vykonávania skriptu\")+ \n  scale_y_continuous(limits = c(0, 95))\n```\n***\n- a = prvotný kód\n- b = alokácia pamäti, vektorizované výpočty, matica namiesto tabuľky\n- c = paralelizované\n\nIntel(R) Core(TM) i5-2450M CPU @ 2.50GHz\n\n2 jadrá - 4 thready\n\nPokračovanie\n========================================================\n- zlepšiť výber najpodobnejších záznamov do trénovacej množiny\n- vyskúšať iné predikčné metódy (neurónová sieť, quantile random forest, support vector machine)\n  - potreba procesorového času\n  - malý potenciál pre zlepšenie\n- postprocessing - štatistická úprava predpovedí\n  - veľký potenciál pre zlepšenie\n  - veľká náročnosť \n  - potreba človekohodín \n\n========================================================\n```{r, echo=FALSE}\nvys  <- read.table(header = T, text='nastavenia metrika chyba\n 1 \"po dňoch\" rRMSE 25.19\n 2 \"po dňoch\" rMAE  19.08\n 3 \"po hodinách\" rRMSE 24.55\n 4 \"po hodinách\" rMAE  18.65')\nvys$metrika <- factor(vys$metrika, levels = c(\"rRMSE\", \"rMAE\"))\n#vys$nastavenia <- factor(vys$nastavenia, levels = c(\"30 predch. dní\", \"30 najpodob. dní\"))\nlibrary(ggplot2)\nggplot(vys, aes(nastavenia, chyba, fill = metrika)) + \n  geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n  scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Spôsob predikcie\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 28))\n```\n\n========================================================\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie metrika chyba\n 1 zima rRMSE 41.39\n 2 zima rMAE  31.77\n 3 leto rRMSE 19.00\n 4 leto rMAE  14.28')\ndf$obdobie <- factor(df$obdobie, levels = c(\"zima\", \"leto\"))\ndf$metrika <- factor(df$metrika, levels = c(\"rRMSE\", \"rMAE\"))\nlibrary(ggplot2)\nggplot(df, aes(obdobie, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Obdobie\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 45))\n```\n\n========================================================\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='dataset metrika chyba\n 1 A rRMSE 24.53\n 2 A rMAE  18.63\n 3 B rRMSE 23.17\n 4 B rMAE  17.52\n 5 C rRMSE 22.34\n 6 C rMAE  16.79\n 7 D rRMSE 24.57\n 8 D rMAE  18.65\n 9 E rRMSE 23.18\n 10 E rMAE 17.53 ')\ndf$metrika <- factor(df$metrika, levels = c(\"rRMSE\", \"rMAE\"))\nlibrary(ggplot2)\nggplot(df, aes(dataset, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Dátová množina\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 27))\n```\n\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='dataset metrika chyba\n 1 A rRMSE 24.37\n 2 A rMAE  18.36\n 3 B rRMSE 23.02\n 4 B rMAE  17.29\n 5 C rRMSE 22.32\n 6 C rMAE  16.54\n 7 D rRMSE 24.35\n 8 D rMAE  18.27\n 9 E rRMSE 23.07\n 10 E rMAE 17.34 ')\ndf$metrika <- factor(df$metrika, levels = c(\"rRMSE\", \"rMAE\"))\nlibrary(ggplot2)\nggplot(df, aes(dataset, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Dátová množina\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 27))\n```\n\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='dataset metrika chyba\n 1 A rRMSE 44.19\n 2 A rMAE  28.67\n 3 B rRMSE 37.24\n 4 B rMAE  26.88\n 5 C rRMSE 34.19\n 6 C rMAE  25.26\n 7 D rRMSE 40.84\n 8 D rMAE  28.43\n 9 E rRMSE 37.19\n 10 E rMAE 26.91 ')\ndf$metrika <- factor(df$metrika, levels = c(\"rRMSE\", \"rMAE\"))\nlibrary(ggplot2)\nggplot(df, aes(dataset, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Dátová množina\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 47))\n```\n\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie metrika chyba\n 1 leto SD 306\n 2 leto RMSE  306\n 3 leto MAE 229\n 4 zima SD  286\n 5 zima RMSE 286\n 6 zima MAE  217\n ')\ndf$metrika <- factor(df$metrika, levels = c(\"RMSE\", \"MAE\", \"SD\"))\ndf$obdobie <- factor(df$obdobie, levels = c(\"leto\", \"zima\"))\nlibrary(ggplot2)\nggplot(df, aes(obdobie, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Obdobie roka\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 340))\n```\n\n```{r, echo=FALSE}\ndf  <- read.table(header = T, text='obdobie metrika chyba\n 7 leto SD 44\n 8 leto RMSE 44\n 9 leto MAE 28\n 10 zima SD 43\n 11 zima RMSE 43\n 12 zima MAE 28\n ')\ndf$metrika <- factor(df$metrika, levels = c(\"RMSE\", \"MAE\", \"SD\"))\ndf$obdobie <- factor(df$obdobie, levels = c(\"leto\", \"zima\"))\nlibrary(ggplot2)\nggplot(df, aes(obdobie, chyba, fill = metrika)) + \n geom_bar(stat=\"identity\", position = \"dodge\", show.legend = T) + \n scale_fill_brewer(palette = \"Set1\") +\n  geom_text(aes(label = chyba, y = chyba), \n            position=position_dodge(width=0.9), vjust=-0.25, size = 9) + \n  theme(text = element_text(size = 25)) +\n  xlab(\"Obdobie roka\") +\n  ylab(\"Chyba\") + \n  #ggtitle(\"Porovnanie chyby predikcie podľa \\n spôsobu výberu trénovacej množiny\") + \n  scale_y_continuous(limits = c(0, 48))\n```",
    "created" : 1460390504152.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1775385186",
    "id" : "FF82EDD8",
    "lastKnownWriteTime" : 1462824873,
    "last_content_update" : 1462824873370,
    "path" : "~/GitHub/baka/R source/pres/presentation.Rpres",
    "project_path" : "presentation.Rpres",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_presentation"
}